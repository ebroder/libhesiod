# Makefile for the Project Athena Hesiod Nameserver library
#
#	$Source: /afs/dev.mit.edu/source/repository/athena/lib/hesiod/Imakefile,v $
#	$Author: probe $
#	$Header: /afs/dev.mit.edu/source/repository/athena/lib/hesiod/Imakefile,v 1.5 1991-01-21 13:12:04 probe Exp $

#if defined(_AIX) && defined(_IBMR2)
MACHDEF= -DBIT_ZERO_ON_LEFT
#endif

DEFINES= -DHESIOD $(MACHDEF)
INCPATH= -I.

SRCS = hesiod.c hespwnam.c hesmailhost.c hesservbyname.c resolve.c cistrcmp.c 
OBJS = hesiod.o hespwnam.o hesmailhost.o hesservbyname.o resolve.o cistrcmp.o 
TOOLS = hesinfo
INCDIR= $(ATHINCDIR)
LIBDIR= $(ATHLIBDIR)
LINTDIR= /usr/lib/lint
BINDIR= /bin/athena
MANDIR= /usr/man/
MAN1= man1
MAN3= man3

.c.o:
	-$(CC) -c -pg ${CFLAGS} $*.c
	-mv $*.o profiled/$*.o
	$(CC) -c ${CFLAGS} $*.c

all::	hesiod.a ${TOOLS} llib-lhesiod.ln

install::
	install -c -m 644 hesiod.a ${DESTDIR}${LIBDIR}/libhesiod.a
	ranlib ${DESTDIR}/${LIBDIR}/libhesiod.a
	install -c -m 644 hesiod_p.a ${DESTDIR}${LIBDIR}/libhesiod_p.a
	ranlib ${DESTDIR}/${LIBDIR}/libhesiod_p.a
	install -c -m 644 hesiod.h ${DESTDIR}${INCDIR}/hesiod.h
	install -c -m 644 hesiod.3 ${DESTDIR}${MANDIR}${MAN3}
	install -c -m 644 hesinfo.1 ${DESTDIR}${MANDIR}${MAN1}
	install -c -m 644 llib-lhesiod.ln ${DESTDIR}${LINTDIR}/llib-lhesiod.ln

hesiod.a:	${OBJS}
	@echo Building Hesiod library...
#if defined(ultrix) && defined(ULTRIX31)
	rm -rf tmp
	mkdir tmp
	(cd tmp; ar x /usr/local/lib/libresolv.a)
	ar rc $@ ${OBJS} tmp//**/*.o
	ranlib $@
	rm -rf tmp
	mkdir tmp
	(cd tmp; ar x /usr/local/lib/libresolv_p.a)
	cd profiled; ar rc ../hesiod_p.a ${OBJS} ../tmp//**/*.o
	ranlib hesiod_p.a
#else
	ar rc $@ ${OBJS}
	-ranlib $@
	cd profiled; ar rc ../hesiod_p.a ${OBJS}
	-ranlib hesiod_p.a
#endif

build_program(hesinfo, hesinfo.o hesiod.a,,,,/bin/athena)

saber:
	saber ${INCPATH} ${DEFINES} hesinfo.c ${SRCS}

clean::	
	-rm -f hesiod.a hesiod_p.a *.o ${TOOLS} *~ profiled/?*.o llib-lhesiod.ln

llib-lhesiod.ln: $(SRCS)
	lint ${LINTCFLAG}hesiod $(LINTFLAGS) $(CFLAGS) $(SRCS)

depend::
	touch Make.depend; makedepend -fMake.depend ${CFLAGS} ${SRCS} hesinfo.c
# DO NOT DELETE THIS LINE -- make depend depends on it.
